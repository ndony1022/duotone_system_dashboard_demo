<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>삼성닷컴 시스템맵 – MX 데모(레벨링)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
<style>
:root{
  --primary:#1428a0;--secondary:#0074c4;--accent:#00a4e4;--ink:#1f2a37;--muted:#64748b;
  --ok:#21c189;--warn:#f59e0b;--err:#ef4444;--panel:#fff;--bg:#f5f7fb;--line:#e5e7eb;
}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,'Apple SD Gothic Neo','Malgun Gothic',sans-serif}
.container{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
.sidebar{background:var(--primary);color:#fff}
.logo{padding:18px;border-bottom:1px solid rgba(255,255,255,.15);display:flex;align-items:center;gap:10px;font-weight:800}
.nav-section{padding:10px}
.nav-title{opacity:.75;font-size:12px;margin:10px 6px}
.nav-item{padding:10px 12px;border-radius:10px;display:flex;gap:10px;align-items:center;cursor:pointer}
.nav-item:hover,.nav-item.active{background:rgba(255,255,255,.12)}
.main-content{padding:22px 26px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--line)}
.page-title{font-size:22px;font-weight:800}
.page-subtitle{color:#94a3b8;font-size:13px;margin-top:4px}
.btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:9px 12px;display:inline-flex;gap:8px;align-items:center;cursor:pointer}
.btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0 16px}
.search-box{position:relative}
.search-box input{padding:10px 12px 10px 36px;width:260px;border:1px solid var(--line);border-radius:10px;background:#fff}
.search-box i{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#9aa4b2}
.pill{padding:7px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;cursor:pointer}
.pill.on{background:#111827;color:#fff;border-color:#111827}
.viewbtn{padding:7px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:12px;cursor:pointer}
.viewbtn.on{background:var(--primary);color:#fff;border-color:var(--primary)}
.visualization-area{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,.06)}
.stage{position:relative;height:680px;border:1px dashed var(--line);border-radius:12px;overflow:hidden;background:
  radial-gradient(circle at 24px 24px, rgba(20,40,160,.03) 0 2px, transparent 2px 100%) 0 0/48px 48px}
.level-band{position:absolute;left:0;width:100%;height:120px;border-bottom:1px dashed var(--line);background:rgba(2,6,23,.015)}
.level-label{position:absolute;left:8px;top:6px;font-size:11px;color:#64748b;font-weight:700}
#linksLayer{position:absolute;inset:0;pointer-events:none}
.node{position:absolute;min-width:140px;max-width:180px;background:#fff;border:1px solid var(--line);border-radius:12px;padding:8px 10px;font-size:13px;
  box-shadow:0 8px 20px rgba(2,6,23,.08);display:flex;align-items:center;gap:8px;cursor:pointer;transition:.15s}
.node:hover{transform:translateY(-2px)}
.node.category{border:2px solid var(--secondary);color:#0e4a6e;font-weight:700;background:#f1f8ff}
.node.main{background:var(--primary);color:#fff;font-weight:800}
.badges{margin-left:6px;display:flex;gap:4px}
.b{font-size:10px;border-radius:999px;padding:2px 6px;border:1px solid var(--line);background:#f8fafc;color:#334155}
.b.v2{background:#e1effe;color:#1e40af;border-color:#bfdbfe}
.b.ok{background:#e8fff7;color:#047857;border-color:#bbf7d0}
.b.warn{background:#fff7e8;color:#b45309;border-color:#fde68a}
.b.err{background:#fff1f2;color:#b91c1c;border-color:#fecdd3}
.cluster{position:absolute;border:1px dashed var(--line);border-radius:14px}
.tag{display:inline-block;padding:3px 8px;border-radius:999px;background:#f1f5f9;border:1px solid #e2e8f0;font-size:11px;margin:2px}
.legend{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px}
.legend .dot{width:12px;height:12px;border-radius:4px;display:inline-block;margin-right:6px;border:1px solid var(--line)}
/* list view */
.table{width:100%;border-collapse:separate;border-spacing:0 8px;font-size:13px}
.table th{padding:8px;color:#475569;text-align:left}
.table td{padding:10px;background:#fff;border:1px solid var(--line)}
.table tr td:first-child{border-radius:10px 0 0 10px}
.table tr td:last-child{border-radius:0 10px 10px 0}
/* detail panel */
.detail-panel{position:fixed;top:0;right:-460px;width:450px;height:100vh;background:#fff;border-left:1px solid var(--line);
  box-shadow:-10px 0 30px rgba(2,6,23,.08);transition:right .25s;z-index:30;padding:20px;overflow:auto}
.detail-panel.open{right:0}
.panel-h{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);padding-bottom:10px;margin-bottom:14px}
.grid{display:grid;grid-template-columns:110px 1fr;gap:8px;font-size:13px}
.k{color:#64748b}
.status-badge{padding:3px 8px;border-radius:999px;font-size:12px;border:1px solid var(--line)}
.sb-ok{background:#e8fff7;color:#047857}.sb-warn{background:#fff7e8;color:#b45309}.sb-err{background:#fff1f2;color:#b91c1c}
/* wireframe modal */
.modal{position:fixed;inset:0;background:rgba(2,6,23,.5);display:none;align-items:center;justify-content:center;z-index:40}
.modal.show{display:flex}
.wf{width:900px;max-width:92vw;height:620px;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(2,6,23,.25);overflow:hidden;display:grid;grid-template-rows:52px 1fr}
.wf-h{display:flex;align-items:center;justify-content:space-between;background:#0b1227;color:#cbd5e1;padding:0 14px}
.wf-body{background:linear-gradient(#f3f6fb,#eef2f7);padding:16px;overflow:auto}
.wf-skel{background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px}
.skel-bar{height:14px;background:#e5e7eb;border-radius:8px;margin:8px 0}
.skel-img{height:180px;background:#e5e7eb;border-radius:12px;margin:10px 0}
.skel-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.footer{text-align:center;padding:16px;color:#94a3b8;font-size:12px;margin-top:16px}
.page{display:none}.page.active{display:block}
@media (max-width:1100px){.container{grid-template-columns:1fr}.sidebar{display:none}.stage{height:820px}}
</style>
</head>
<body>
<div class="container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo"><i class="fa-solid fa-sitemap"></i> <span>Samsung.com System Map</span></div>
    <div class="nav-section">
      <div class="nav-title">메뉴</div>
      <div class="nav-item active" data-page="sitemap"><i class="fa-solid fa-diagram-project"></i> 사이트맵</div>
      <div class="nav-item" data-page="dashboard"><i class="fa-solid fa-gauge-high"></i> 대시보드</div>
      <div class="nav-item" data-page="analytics"><i class="fa-solid fa-chart-line"></i> 성능 분석</div>
      <div class="nav-item" data-page="content"><i class="fa-solid fa-list-check"></i> 점검 항목</div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main-content">
    <section class="page active" id="sitemap">
      <div class="header">
        <div>
          <div class="page-title">시각적 시스템맵 – MX 중심</div>
          <div class="page-subtitle">L0~L4 레벨 밴드, 더미 와이어프레임, 클릭 액션 포함(프론트 데모)</div>
        </div>
        <div>
          <button class="btn" id="btnExport"><i class="fa-regular fa-circle-down"></i> JSON 내보내기</button>
          <button class="btn primary" id="btnReload"><i class="fa-solid fa-rotate"></i> 새로 고침</button>
        </div>
      </div>

      <div class="controls">
        <div class="search-box">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input id="searchInput" placeholder="페이지/카테고리 검색 (더미)"/>
        </div>
        <!-- 레벨 필터 -->
        <div class="pill on" data-level="all">전체 레벨</div>
        <div class="pill" data-level="0">L0</div>
        <div class="pill" data-level="1">L1</div>
        <div class="pill" data-level="2">L2</div>
        <div class="pill" data-level="3">L3</div>
        <div class="pill" data-level="4">L4</div>
        <!-- 클러스터(카테고리) 필터 -->
        <div class="pill on" data-cluster="all">전체 카테고리</div>
        <div class="pill" data-cluster="smartphones">스마트폰</div>
        <div class="pill" data-cluster="tablets">태블릿</div>
        <div class="pill" data-cluster="book">Book/PC</div>
        <div class="pill" data-cluster="watch">워치</div>
        <div class="pill" data-cluster="buds">버즈</div>
        <div class="pill" data-cluster="acc">액세서리</div>
        <!-- 뷰 모드 -->
        <div class="viewbtn on" data-view="tree"><i class="fa-solid fa-diagram-project"></i> 계층</div>
        <div class="viewbtn" data-view="list"><i class="fa-solid fa-table-list"></i> 목록</div>
        <div class="viewbtn" data-view="net"><i class="fa-solid fa-share-nodes"></i> 네트워크</div>
      </div>

      <div class="visualization-area">
        <!-- 캔버스 -->
        <div class="stage" id="stage">
          <!-- 레벨 밴드(120px * 5) -->
          <div class="level-band" style="top:0"><span class="level-label">L0 · Home/Global</span></div>
          <div class="level-band" style="top:120px"><span class="level-label">L1 · 카테고리 허브</span></div>
          <div class="level-band" style="top:240px"><span class="level-label">L2 · 제품군/세부 카테고리</span></div>
          <div class="level-band" style="top:360px"><span class="level-label">L3 · PD(제품 상세) 상위</span></div>
          <div class="level-band" style="top:480px"><span class="level-label">L4 · Buying/옵션/장바구니</span></div>
          <svg id="linksLayer"></svg>
        </div>

        <!-- 목록 뷰(토글) -->
        <div id="listView" style="display:none;margin-top:12px">
          <table class="table" id="table">
            <thead><tr><th>레벨</th><th>페이지</th><th>카테고리</th><th>상태</th><th>DS</th><th>담당</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="legend">
          <span><span class="dot" style="background:#1428a0;border-color:#0f1f73"></span>메인</span>
          <span><span class="dot" style="background:#f1f8ff;border-color:#7cc0ff"></span>카테고리</span>
          <span><span class="dot" style="background:#ffffff"></span>일반</span>
          <span><span class="dot" style="background:#e8fff7"></span>정상</span>
          <span><span class="dot" style="background:#fff7e8"></span>업데이트 필요</span>
          <span><span class="dot" style="background:#fff1f2"></span>확인 필요</span>
        </div>
      </div>

      <div class="footer">© 2025 Samsung.com System Map Demo • MX Focus • Visual Front-end Only</div>
    </section>

    <!-- 대시보드 더미 -->
    <section class="page" id="dashboard">
      <div class="header"><div><div class="page-title">대시보드(더미)</div><div class="page-subtitle">KPI 및 추세 시각만 제공</div></div></div>
      <div class="visualization-area" style="height:360px;display:grid;place-items:center;color:#94a3b8">추가 예정</div>
    </section>

    <section class="page" id="analytics"><div class="header"><div class="page-title">성능 분석(더미)</div></div>
      <div class="visualization-area" style="height:360px;display:grid;place-items:center;color:#94a3b8">추가 예정</div></section>
    <section class="page" id="content"><div class="header"><div class="page-title">점검 항목(더미)</div></div>
      <div class="visualization-area" style="height:360px;display:grid;place-items:center;color:#94a3b8">추가 예정</div></section>
  </main>
</div>

<!-- 상세 패널 -->
<aside class="detail-panel" id="detail">
  <div class="panel-h">
    <strong id="d-title">페이지 상세</strong>
    <div>
      <button class="btn" id="btnWire"><i class="fa-regular fa-window-maximize"></i> 와이어프레임</button>
      <button class="btn" id="btnClose"><i class="fa-solid fa-xmark"></i></button>
    </div>
  </div>
  <div class="grid">
    <div class="k">ID</div><div id="d-id">-</div>
    <div class="k">URL</div><div id="d-url">-</div>
    <div class="k">레벨</div><div id="d-level">-</div>
    <div class="k">카테고리</div><div id="d-cluster">-</div>
    <div class="k">상태</div><div id="d-status">-</div>
    <div class="k">DS</div><div id="d-ds">-</div>
    <div class="k">담당</div><div id="d-owner">-</div>
  </div>
  <div style="margin-top:12px">
    <div class="k" style="margin-bottom:6px">컴포넌트(샘플)</div>
    <span class="tag">C004 Category HScroll</span><span class="tag">FT02 Feature Grid</span>
    <span class="tag">PD01 Product Cards</span><span class="tag">BN01 Key Visual</span>
  </div>
</aside>

<!-- 와이어프레임 모달 -->
<div class="modal" id="modal">
  <div class="wf">
    <div class="wf-h"><div><i class="fa-regular fa-window-maximize"></i> <span id="m-title">Wireframe</span></div>
      <button class="btn" id="m-close"><i class="fa-solid fa-xmark"></i></button></div>
    <div class="wf-body" id="m-body">
      <!-- 채워짐 -->
    </div>
  </div>
</div>

<script>
/* ---------- 데이터(간단) ---------- */
const bandH = 120, leftBase = 140, colW = 170;
const nodes = [
  // L0
  {id:'home', title:'홈', level:0, col:0, row:0, type:'main', status:'ok', ds:'v2.0', cluster:'global'},
  // L1 허브
  {id:'smartphones', title:'Smartphones 허브', level:1, col:1, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'smartphones'},
  {id:'tablets',     title:'Tablets 허브',     level:1, col:3, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'tablets'},
  {id:'book',        title:'Book/Laptops 허브',level:1, col:5, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'book'},
  {id:'watch',       title:'Watch 허브',       level:1, col:7, row:0, type:'category', status:'warn', ds:'v1.6', cluster:'watch'},
  {id:'buds',        title:'Buds 허브',        level:1, col:9, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'buds'},
  {id:'acc',         title:'Galaxy Accessories',level:1,col:11,row:0,type:'category',status:'ok',ds:'v2.0',cluster:'acc'},

  // L2 Smartphones 세부
  {id:'sp-all',  title:'All',     level:2,col:1,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-s',    title:'Galaxy S',level:2,col:2,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-z',    title:'Galaxy Z',level:2,col:3,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-a',    title:'Galaxy A',level:2,col:4,row:0,parent:'smartphones',cluster:'smartphones',status:'warn',ds:'v1.7'},
  {id:'sp-comp', title:'Compare', level:2,col:5,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-acc',  title:'Accessories',level:2,col:6,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},

  // L2 Tablets
  {id:'tb-all', title:'All',level:2,col:3,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'tb-s',   title:'Tab S',level:2,col:4,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'tb-a',   title:'Tab A',level:2,col:5,row:1,parent:'tablets',cluster:'tablets',status:'warn',ds:'v1.6'},
  {id:'tb-comp',title:'Compare',level:2,col:6,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'tb-acc', title:'Accessories',level:2,col:7,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},

  // L2 Watch
  {id:'wt-all', title:'All',level:2,col:7,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-ultra',title:'Watch Ultra',level:2,col:8,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-classic',title:'Watch Classic',level:2,col:9,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-comp',title:'Compare',level:2,col:10,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-acc', title:'Accessories',level:2,col:11,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},

  // L2 Buds
  {id:'bd-all', title:'All',level:2,col:9,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-pro', title:'Buds3 Pro',level:2,col:10,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-3',   title:'Buds3',level:2,col:11,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-fe',  title:'Buds FE',level:2,col:12,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-comp',title:'Compare',level:2,col:13,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},

  // L2 Book/PC
  {id:'bk-all', title:'All',level:2,col:5,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-book',title:'Book',level:2,col:6,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-360', title:'Book 360',level:2,col:7,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-chr', title:'Chromebook',level:2,col:8,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-gpc', title:'C/PC',level:2,col:9,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-comp',title:'Compare',level:2,col:10,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},

  // L3 PD 상위(스마트폰)
  {id:'pd-s-flag',title:'Flagship PD (S)',level:3,col:2,row:0,parent:'sp-s',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'pd-z-flag',title:'Flagship PD (Z)',level:3,col:3,row:0,parent:'sp-z',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'pd-a-std', title:'Standard PD (A)',level:3,col:4,row:0,parent:'sp-a',cluster:'smartphones',status:'warn',ds:'v1.7'},
  // L3 Tablets PD
  {id:'pd-tab-flag',title:'Flagship PD (Tab S)',level:3,col:4,row:1,parent:'tb-s',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'pd-tab-std', title:'Standard PD (Tab A)',level:3,col:5,row:1,parent:'tb-a',cluster:'tablets',status:'warn',ds:'v1.6'},
  // L3 Other
  {id:'pd-watch-feat',title:'Featured PD (Watch)',level:3,col:8,row:0,parent:'wt-ultra',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'pd-buds-std',title:'Standard PD (Buds)',level:3,col:11,row:1,parent:'bd-3',cluster:'buds',status:'ok',ds:'v2.0'},

  // L4 Buying/옵션
  {id:'buy-flag-s',title:'Flagship Buying PD (S)',level:4,col:2,row:0,parent:'pd-s-flag',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'buy-flag-z',title:'Flagship Buying PD (Z)',level:4,col:3,row:0,parent:'pd-z-flag',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'buy-simple-a',title:'Simple Buying PD (A)',level:4,col:4,row:0,parent:'pd-a-std',cluster:'smartphones',status:'warn',ds:'v1.7'},
  {id:'buy-tab',title:'Buying PD (Tab)',level:4,col:4,row:1,parent:'pd-tab-flag',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'cart',title:'Cart Page',level:4,col:6,row:2,parent:'buy-flag-s',cluster:'global',status:'ok',ds:'v2.0'},
];

/* ---------- 렌더 ---------- */
const stage = document.getElementById('stage');
const linksLayer = document.getElementById('linksLayer');
const listTbody = document.querySelector('#table tbody');
function xy(n){ return {x:leftBase + n.col*colW, y: 20 + n.level*bandH + n.row*34}; }

function paint(){
  stage.querySelectorAll('.node,.cluster').forEach(e=>e.remove());
  linksLayer.innerHTML='';
  // 노드 DOM
  nodes.forEach(n=>{
    const pos = xy(n);
    const el = document.createElement('div');
    el.className = 'node' + (n.type==='category'?' category':'') + (n.type==='main'?' main':'');
    el.style.left = pos.x+'px'; el.style.top = pos.y+'px';
    el.dataset.id=n.id; el.dataset.level=n.level; el.dataset.cluster=n.cluster; el.title=n.title;
    el.innerHTML = `${n.type==='main'?'<i class="fa-solid fa-house"></i>':''}${n.type==='category'?'<i class="fa-solid fa-layer-group"></i>':''}${(n.type!=='main'&&n.type!=='category')?'<i class="fa-regular fa-file"></i>':''}
      ${n.title}
      <span class="badges">
        <span class="b ${n.ds?.startsWith('v2')?'v2':''}">${n.ds||'v—'}</span>
        <span class="b ${n.status==='ok'?'ok':n.status==='warn'?'warn':'err'}">${n.status==='ok'?'정상':n.status==='warn'?'업데이트':'확인'}</span>
      </span>`;
    el.addEventListener('click',()=>openDetail(n));
    el.addEventListener('dblclick',()=>openWire(n));
    stage.appendChild(el);
  });
  // 커넥터
  nodes.filter(n=>n.parent).forEach(n=>{
    const c = stage.querySelector(`.node[data-id="${n.id}"]`).getBoundingClientRect();
    const p = stage.querySelector(`.node[data-id="${n.parent}"]`).getBoundingClientRect();
    const s = stage.getBoundingClientRect();
    const x1 = p.left - s.left + (p.width/2), y1 = p.top - s.top + p.height;
    const x2 = c.left - s.left + (c.width/2), y2 = c.top - s.top;
    linksLayer.insertAdjacentHTML('beforeend', `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="#cfd8e3" stroke-width="2"/>`);
  });

  // 목록 뷰 데이터
  listTbody.innerHTML = nodes.map(n=>`
    <tr>
      <td>L${n.level}</td><td>${n.title}</td><td>${n.cluster}</td>
      <td>${n.status==='ok'?'<span class="b ok">정상</span>':n.status==='warn'?'<span class="b warn">업데이트</span>':'<span class="b err">확인'}</span></td>
      <td><span class="b ${n.ds?.startsWith('v2')?'v2':''}">${n.ds||''}</span></td>
      <td>A/B/C 에이전시</td>
    </tr>
  `).join('');
}
paint();

/* ---------- 상호작용 ---------- */
// 페이지 전환
document.querySelectorAll('.nav-item').forEach(i=>{
  i.addEventListener('click',()=>{
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active')); i.classList.add('active');
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(i.dataset.page).classList.add('active');
  });
});

// 검색
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input',()=>{
  const q = searchInput.value.trim().toLowerCase();
  stage.querySelectorAll('.node').forEach(n=>{
    const match = n.textContent.toLowerCase().includes(q);
    n.style.opacity = q? (match? '1': '.2') : '1';
    n.style.outline = match? '2px solid var(--accent)' : 'none';
  });
});

// 레벨 필터
document.querySelectorAll('.pill[data-level]').forEach(p=>{
  p.addEventListener('click',()=>{
    document.querySelectorAll('.pill[data-level]').forEach(x=>x.classList.remove('on')); p.classList.add('on');
    const lv = p.dataset.level;
    stage.querySelectorAll('.node').forEach(n=>{
      const ok = (lv==='all') || (n.dataset.level===lv);
      n.style.display = ok? 'flex':'none';
    });
    // 커넥터 재도색
    paint(); // 간단 재렌더(데모용)
  });
});

// 클러스터 필터
document.querySelectorAll('.pill[data-cluster]').forEach(p=>{
  p.addEventListener('click',()=>{
    document.querySelectorAll('.pill[data-cluster]').forEach(x=>x.classList.remove('on')); p.classList.add('on');
    const c = p.dataset.cluster;
    stage.querySelectorAll('.node').forEach(n=>{
      const ok = (c==='all') || (n.dataset.cluster===c);
      n.style.display = ok? 'flex':'none';
    });
    paint();
  });
});

// 뷰 전환
const listView = document.getElementById('listView');
document.querySelectorAll('.viewbtn').forEach(v=>{
  v.addEventListener('click',()=>{
    document.querySelectorAll('.viewbtn').forEach(x=>x.classList.remove('on')); v.classList.add('on');
    const mode = v.dataset.view;
    if(mode==='tree'){ stage.style.display='block'; listView.style.display='none'; }
    if(mode==='list'){ stage.style.display='none'; listView.style.display='block'; }
    if(mode==='net'){ stage.style.display='block'; listView.style.display='none'; alert('네트워크 뷰는 시각적 더미입니다.'); }
    paint();
  });
});

// JSON 내보내기
document.getElementById('btnExport').addEventListener('click',()=>{
  const payload = {exportedAt:new Date().toISOString(), nodes};
  const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='mx-system-map-demo.json'; a.click();
  URL.revokeObjectURL(a.href);
});
document.getElementById('btnReload').addEventListener('click',()=>location.reload());

/* ---------- 상세/모달 ---------- */
const detail = document.getElementById('detail');
function openDetail(n){
  document.getElementById('d-title').textContent = n.title;
  document.getElementById('d-id').textContent = n.id;
  document.getElementById('d-url').innerHTML = `<a href="#" onclick="return false;">https://www.samsung.com/kr/mx/${n.id}</a>`;
  document.getElementById('d-level').textContent = 'L'+n.level;
  document.getElementById('d-cluster').textContent = n.cluster;
  document.getElementById('d-ds').innerHTML = `<span class="status-badge ${n.ds?.startsWith('v2')?'sb-ok':'sb-warn'}">${n.ds}</span>`;
  const st = n.status==='ok'?'sb-ok':n.status==='warn'?'sb-warn':'sb-err';
  document.getElementById('d-status').innerHTML = `<span class="status-badge ${st}">${n.status==='ok'?'정상':n.status==='warn'?'업데이트 필요':'관리자 확인'}</span>`;
  document.getElementById('d-owner').textContent = 'MX 사업부 · A/B/C 에이전시';
  detail.classList.add('open');
}
document.getElementById('btnClose').addEventListener('click',()=>detail.classList.remove('open'));

// 모달(와이어프레임)
const modal = document.getElementById('modal'), mBody=document.getElementById('m-body'), mTitle=document.getElementById('m-title');
document.getElementById('m-close').addEventListener('click',()=>modal.classList.remove('show'));
document.getElementById('btnWire').addEventListener('click',()=>modal.classList.add('show'));
function openWire(n){
  mTitle.textContent = `${n.title} · Wireframe`;
  mBody.innerHTML = `
    <div class="wf-skel">
      <div class="skel-bar" style="width:40%"></div>
      <div class="skel-bar" style="width:65%"></div>
      <div class="skel-img"></div>
      <div class="skel-grid">
        <div class="wf-skel"><div class="skel-img" style="height:90px"></div><div class="skel-bar" style="width:70%"></div><div class="skel-bar" style="width:50%"></div></div>
        <div class="wf-skel"><div class="skel-img" style="height:90px"></div><div class="skel-bar" style="width:70%"></div><div class="skel-bar" style="width:50%"></div></div>
        <div class="wf-skel"><div class="skel-img" style="height:90px"></div><div class="skel-bar" style="width:70%"></div><div class="skel-bar" style="width:50%"></div></div>
      </div>
      <div class="skel-bar" style="width:92%"></div>
      <div class="skel-bar" style="width:84%"></div>
      <div class="skel-bar" style="width:76%"></div>
    </div>`;
  modal.classList.add('show');
}

/* ---------- 접근성 ---------- */
document.addEventListener('keydown',(e)=>{
  if(e.key==='Escape'){ detail.classList.remove('open'); modal.classList.remove('show'); }
});
</script>
</body>
</html>
