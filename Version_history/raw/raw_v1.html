<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>삼성닷컴 시스템맵 – MX 데모 v4 (PDF 반영)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
<style>
:root{
  --primary:#1428a0;--secondary:#0074c4;--accent:#00a4e4;--ink:#1f2a37;--muted:#64748b;
  --ok:#21c189;--warn:#f59e0b;--err:#ef4444;--panel:#fff;--bg:#f5f7fb;--line:#e5e7eb;
  --fs-backdrop:#f6f5ef; /* 전체화면 배경(미색) */
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,'Apple SD Gothic Neo','Malgun Gothic',sans-serif}
.container{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
.sidebar{background:var(--primary);color:#fff}
.logo{padding:18px;border-bottom:1px solid rgba(255,255,255,.15);display:flex;align-items:center;gap:10px;font-weight:800}
.nav-section{padding:10px}
.nav-title{opacity:.75;font-size:12px;margin:10px 6px}
.nav-item{padding:10px 12px;border-radius:10px;display:flex;gap:10px;align-items:center;cursor:pointer}
.nav-item:hover,.nav-item.active{background:rgba(255,255,255,.12)}
.main-content{padding:22px 26px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--line)}
.page-title{font-size:22px;font-weight:800;padding: 4px 0;}
.page-subtitle{color:#94a3b8;font-size:13px;margin-top:4px}
.btn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:9px 12px;display:inline-flex;gap:8px;align-items:center;cursor:pointer}
.btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
.controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0 16px}
.search-box{position:relative}
.search-box input{padding:10px 12px 10px 36px;width:260px;border:1px solid var(--line);border-radius:10px;background:#fff}
.search-box i{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#9aa4b2}
.pill{padding:7px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;cursor:pointer}
.pill.on{background:#111827;color:#fff;border-color:#111827}
.pill.multi{background:#111827;color:#fff;border-color:#111827}
.viewbtn{padding:7px 10px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:12px;cursor:pointer}
.viewbtn.on{background:var(--primary);color:#fff;border-color:var(--primary)}
.visualization-area{position:relative;background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,.06)}

/* 하단 고정 영역 (bottom-area) */
.bottom-area{position:fixed;bottom:102px;right:60px;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--line);border-radius:10px;padding:20px;box-shadow:0 8px 20px rgba(2,6,23,.08);z-index:6;max-width:400px}
.bottom-area.fixed-bottom{position:fixed;right:24px;bottom:24px}
.bottom-area,.bottom-area.fixed-bottom{padding:20px;min-height:40px;max-width:400px}
.bottom-area .title{font-size:12px;color:#334155;font-weight:700}
/* Version Info 필터 버튼 */
.ver-pills{display:flex;gap:8px;align-items:center}
.ver-pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:11px;cursor:pointer}
.ver-pill.on{background:#111827;color:#fff;border-color:#111827}
.ver-pills.disabled{pointer-events:none;opacity:.5}
/* 토글 스위치 */
.switch{position:relative;display:inline-block;width:44px;height:24px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;inset:0;background:#cbd5e1;border-radius:999px;transition:.2s}
.slider:before{content:"";position:absolute;height:18px;width:18px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.2s;box-shadow:0 1px 2px rgba(0,0,0,.2)}
.switch input:checked + .slider{background:var(--primary)}
.switch input:checked + .slider:before{transform:translateX(20px)}

/* 다크 테마 (visualization-area 내부 전환) */
.visualization-area.dark{background:#0b1227;border-color:#0b1227;color:#e2e8f0}
.visualization-area.dark .legend span{color:#cbd5e1}
.visualization-area.dark .stage{background:#0f172a;border-color:#1f2937}
.visualization-area.dark .node{background:#0f1a36;color:#e5e7eb;border-color:#243046;box-shadow:0 8px 20px rgba(0,0,0,.35)}
.visualization-area.dark .node.category{background:#0e223d;border-color:#1b4b7b;color:#dce7f7}
.visualization-area.dark .b{background:#0b1227;color:#cbd5e1;border-color:#334155}
.visualization-area.dark .b.v2{background:#0e2244;color:#93c5fd;border-color:#1d4ed8}
.visualization-area.dark .b.ok{background:#052e2b;color:#34d399;border-color:#065f46}
.visualization-area.dark .b.warn{background:#3b2f07;color:#fbbf24;border-color:#92400e}
.visualization-area.dark .b.err{background:#3f0a0a;color:#fca5a5;border-color:#b91c1c}
/* 다크 테마에서 DS 기반 배경 가이드 (JS가 inline style로 적용) */

/* 전체화면 상단바 */
.fs-topbar{position:fixed;left:0;right:0;top:0;height:44px;display:none;align-items:center;padding:0 16px;background:#fff;border-bottom:1px solid var(--line);box-shadow:0 6px 16px rgba(2,6,23,.06);z-index:50;font-weight:800;color:#1f2937}

/* LNB 영역 */
.lnb{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 30px rgba(2,6,23,.06);margin:8px 0}
.lnb-inner{display:flex;gap:20px;align-items:center;flex-wrap:wrap;padding:16px}
.lnb-group{display:flex;gap:10px;align-items:center}
.lnb-title{font-weight:700;color:#475569;font-size:13px}
.lnb-items{display:flex;gap:10px;align-items:center}
.lnb-select{padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;font-size:12px;color:#111827;width:160px}
/* LNB 국가 버튼 고정 폭 */
.lnb-items .pill[data-locale]{width:60px;text-align:center}

/* ▶ stage: 스크롤/밴드/레이어 */
.stage{position:relative;height:720px;border:1px dashed var(--line);border-radius:12px;overflow:auto;background:
  radial-gradient(circle at 24px 24px, rgba(20,40,160,.03) 0 2px, transparent 2px 100%) 0 0/48px 48px}
.stage:fullscreen{border:none}
.stage::backdrop{background:var(--fs-backdrop)} /* 전체화면 배경색 미색 */
#bands{position:absolute;inset:0;z-index:0;pointer-events:none}
.level-band{position:absolute;left:0;width:100%;border-bottom:1px dashed var(--line);background:rgba(2,6,23,.015)}
.level-label{position:absolute;left:8px;top:6px;font-size:11px;color:#64748b;font-weight:700}
#linksLayer{position:absolute;width:100%;height:100%;inset:0;pointer-events:none;z-index:1}

/* ▶ 노드: 썸네일 + 여백 (PDF 간격 반영) */
.node{position:absolute;min-width:220px;max-width:260px;background:#fff;border:1px solid var(--line);border-radius:12px;
  padding:10px 12px;font-size:12.5px;box-shadow:0 8px 20px rgba(2,6,23,.08);
  display:grid;grid-template-columns:60px 1fr;gap:12px;cursor:pointer;transition:.15s;z-index:2}
.node:hover{transform:translateY(-2px)}
.node.category{border:2px solid var(--secondary);color:#0e4a6e;font-weight:700;background:#f1f8ff}
.node.main{background:var(--primary);color:#fff;font-weight:800;grid-template-columns:1fr}
.node .title{display:flex;align-items:center;gap:6px}
.badges{margin-top:4px;display:flex;gap:6px;flex-wrap:wrap}
.b{font-size:10px;border-radius:999px;padding:2px 8px;border:1px solid var(--line);background:#f8fafc;color:#334155}
.b.v2{background:#e1effe;color:#1e40af;border-color:#bfdbfe}
.b.ok{background:#e8fff7;color:#047857;border-color:#bbf7d0}
.b.warn{background:#fff7e8;color:#b45309;border-color:#fde68a}
.b.err{background:#fff1f2;color:#b91c1c;border-color:#fecdd3}

/* ▶ 노드 썸네일(간단 와이어프레임) */
.tn{width:60px;height:44px;border-radius:8px;border:1px solid var(--line);background:#fff;display:block;position:relative;overflow:hidden}
.tn::before{content:'';position:absolute;inset:0;background:linear-gradient(#e9eef7,#f6f8fb)}
.tn .bar{position:absolute;left:6px;right:6px;height:4px;background:#d8dee9;border-radius:3px}
.tn .bar.b1{top:6px}
.tn .bar.b2{top:14px;width:60%}
.tn .kv{position:absolute;left:6px;right:6px;top:22px;height:14px;background:#e1e7f0;border-radius:4px}

/* 목록 */
.legend{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px}
.legend .dot{width:12px;height:12px;border-radius:4px;display:inline-block;margin-right:6px;border:1px solid var(--line)}
.table{width:100%;border-collapse:separate;border-spacing:0 8px;font-size:13px}
.table th{padding:8px;color:#475569;text-align:left}
.table td{padding:10px;background:#fff;border:1px solid var(--line)}
.table tr td:first-child{border-radius:10px 0 0 10px}
.table tr td:last-child{border-radius:0 10px 10px 0}

/* 상세 패널 */
.detail-panel{position:fixed;top:0;right:-500px;width:500px;height:100vh;background:#fff;border-left:1px solid var(--line);
  box-shadow:-10px 0 30px rgba(2,6,23,.08);transition:right .25s;z-index:30;padding:22px;overflow:auto}
.detail-panel.open{right:0}
.detail-panel.fs{position:fixed} /* fullscreen에서도 고정 */
.panel-h{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);padding-bottom:10px;margin-bottom:14px}
.grid{display:grid;grid-template-columns:120px 1fr;gap:10px;font-size:14px}
.k{color:#64748b}
.status-badge{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--line)}
.sb-ok{background:#e8fff7;color:#047857}.sb-warn{background:#fff7e8;color:#b45309}.sb-err{background:#fff1f2;color:#b91c1c}

/* 컴포넌트 배지(칩) */
.badge-wrap{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 14px}
.chip{display:inline-block;padding:8px 12px;border-radius:999px;border:1px solid #d9e0ea;background:#eef2f7;color:#334155;font-size:13px}

/* 상세 패널: 와이어프레임 썸네일(스켈레톤) */
.subttl{font-weight:700;color:#4b5563;margin:18px 0 10px}
.wf-thumb{border:1px solid var(--line);border-radius:12px;background:#fff;padding:18px;max-width:200px;max-height:200px;overflow:hidden}
.wf-h1{height:14px;background:#e5e7eb;border-radius:8px;width:48%;margin-bottom:10px}
.wf-h2{height:12px;background:#e5e7eb;border-radius:8px;width:70%;margin-bottom:16px}
.wf-hero{height:120px;background:#e3e7ee;border-radius:20px;margin-bottom:16px}
.wf-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.card{border:1px solid var(--line);border-radius:12px;padding:12px}
.card .img{height:60px;background:#e5e8ee;border-radius:10px;margin-bottom:8px}
.bar{height:12px;background:#e5e7eb;border-radius:8px;margin:8px 0}
.bar.s{width:64%}.bar.xs{width:46%}

/* wf-thumb 업로드 UI */
.wf-thumb-wrap{position:relative;display:inline-block}
.wf-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,.45);color:#fff;border-radius:12px;cursor:pointer;font-size:13px;gap:12px}
.wf-overlay .btn-mini{border:1px solid rgba(255,255,255,.6);padding:6px 10px;border-radius:8px;background:rgba(255,255,255,.08);color:#fff;display:inline-flex;gap:6px;align-items:center}
.wf-thumb-wrap:hover .wf-overlay{display:flex}
.wf-thumb img{display:block;max-width:100%;max-height:100%;border-radius:8px;object-fit:contain;margin:0 auto}

/* 다운로드 버튼 */
.download-section{margin-top:20px;border-top:1px solid var(--line);padding-top:16px}
.download-buttons{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.download-btn{padding:8px 12px;border:1px solid var(--line);border-radius:8px;background:#fff;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px;transition:.15s}
.download-btn:hover{background:#f8fafc;border-color:var(--primary)}
.download-btn.xd{color:#ff61f6}
.download-btn.sketch{color:#fdad00}
.download-btn.zeplin{color:#0d96f2}

/* 모달 */
.modal{position:fixed;inset:0;background:rgba(2,6,23,.5);display:none;align-items:center;justify-content:center;z-index:40}
.modal.show{display:flex}
.wf{width:900px;max-width:92vw;height:620px;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(2,6,23,.25);overflow:hidden;display:grid;grid-template-rows:52px 1fr}
.wf-h{display:flex;align-items:center;justify-content:space-between;background:#0b1227;color:#cbd5e1;padding:0 14px}
.wf-body{background:linear-gradient(#f3f6fb,#eef2f7);padding:16px;overflow:auto}
.wf-skel{background:#fff;border:1px solid var(--line);border-radius:12px;padding:14px}
.skel-bar{height:14px;background:#e5e7eb;border-radius:8px;margin:8px 0}
.skel-img{height:180px;background:#e5e7eb;border-radius:12px;margin:10px 0}
.skel-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}

/* 기타 */
.footer{text-align:center;padding:16px;color:#94a3b8;font-size:12px;margin-top:16px}
.page{display:none}.page.active{display:block}
.fullscreen-btn{position:absolute;right:16px;top:16px;z-index:5}
/* 전체화면 버튼 여백 확대 */
.btn.fullscreen-btn{padding:16px;top:24px;right: 24px;}

/* 대시보드: KPI/차트 */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:16px}
.kpi{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px;box-shadow:0 8px 20px rgba(2,6,23,.06)}
.kpi-label{color:#64748b;font-size:12px;font-weight:700}
.kpi-value{font-size:32px;font-weight:900;letter-spacing:-0.5px;margin:6px 0}
.kpi-value.primary{color:var(--primary)}
.kpi-value.ok{color:#059669}
.kpi-value.warn{color:#b45309}
.kpi-value.err{color:#b91c1c}
.kpi-sub{color:#94a3b8;font-size:12px}
.progress{height:8px;background:#eef2f7;border-radius:999px;overflow:hidden;margin-top:8px;border:1px solid var(--line)}
.progress span{display:block;height:100%;background:linear-gradient(90deg,#16a34a,#22c55e)}
.chart-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.chart-card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px;box-shadow:0 8px 20px rgba(2,6,23,.06)}
.chart-title{font-weight:800;color:#334155;margin-bottom:10px}
.spark{width:100%;height:120px;display:block}
.bar-legend{display:flex;gap:10px;align-items:center;color:#64748b;font-size:12px;margin-bottom:8px}
.bars{display:flex;flex-direction:column;gap:8px}
.bar-item{display:grid;grid-template-columns:70px 1fr;gap:10px;align-items:center}
.bar-line{position:relative;height:12px;background:#eef2f7;border:1px solid var(--line);border-radius:999px;overflow:hidden}
.bar-line i{position:absolute;left:0;top:0;bottom:0;background:#1e3a8a}
.bar-line i.warn{background:#b45309}
.bar-line i.err{background:#991b1b}
.bar-line em{position:absolute;right:8px;top:50%;transform:translateY(-50%);font-size:11px;color:#0f172a;font-weight:800}

@media (max-width:1100px){
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
  .chart-grid{grid-template-columns:1fr}
}

@media (max-width:1100px){
  .container{grid-template-columns:1fr}
  .sidebar{display:none}
  .stage{height:860px}
}
</style>
</head>
<body>
<div class="container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo"><i class="fa-solid fa-sitemap"></i> <span>Samsung.com System Map</span></div>
    <div class="nav-section">
      <div class="nav-title">메뉴</div>
      <div class="nav-item active" data-page="sitemap"><i class="fa-solid fa-diagram-project"></i> 사이트맵</div>
      <div class="nav-item" data-page="dashboard"><i class="fa-solid fa-gauge-high"></i> 대시보드</div>
      <div class="nav-item" data-page="analytics"><i class="fa-solid fa-chart-line"></i> 성능 분석</div>
      <div class="nav-item" data-page="content"><i class="fa-solid fa-list-check"></i> 점검 항목</div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main-content">
    <section class="page active" id="sitemap">
      <div class="header">
        <div>
          <div class="page-title">System Map</div>
          <div class="page-subtitle">Information for Samsung.com</div>
        </div>
        <div>
          <button class="btn" id="btnExport"><i class="fa-regular fa-circle-down"></i> JSON 내보내기</button>
          <button class="btn primary" id="btnReload"><i class="fa-solid fa-rotate"></i> 새로 고침</button>
        </div>
      </div>

      <div class="lnb">
        <div class="lnb-inner">
          <div class="lnb-group">
            <span class="lnb-title">국가 선택</span>
            <div class="lnb-items">
              <div class="pill on" data-locale="uk">UK</div>
              <div class="pill" data-locale="fr">FR</div>
              <div class="pill" data-locale="de">DE</div>
            </div>
          </div>
          <div class="lnb-group" style="margin-left:20px">
            <span class="lnb-title">사업부 선택</span>
            <div class="lnb-items">
              <select id="bizSelect" class="lnb-select">
                <option value="" selected>사업부 선택</option>
                <option value="mx">MX</option>
                <option value="vd">VD</option>
                <option value="da">DA</option>
                <option value="acc">Accessories</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="search-box">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input id="searchInput" placeholder="페이지/카테고리 검색 (더미)"/>
        </div>
        <div class="pill on" data-level="all">전체 레벨</div>
        <span class="lnb-title">레벨 선택</span>
        <div class="pill" data-level="0">L0</div>
        <div class="pill" data-level="1">L1</div>
        <div class="pill" data-level="2">L2</div>
        <div class="pill" data-level="3">L3</div>
        <div class="pill" data-level="4">L4</div>

        <div class="pill on" data-cluster="all">전체 카테고리</div>
        <span class="lnb-title">카테고리 선택</span>
        <div class="pill" data-cluster="smartphones">스마트폰</div>
        <div class="pill" data-cluster="tablets">태블릿</div>
        <div class="pill" data-cluster="book">Book/PC</div>
        <div class="pill" data-cluster="watch">워치</div>
        <div class="pill" data-cluster="buds">버즈</div>
        <div class="pill" data-cluster="acc">액세서리</div>
        <div class="pill" data-cluster="sub">서브메뉴</div>
        <span style="width:1px;height:20px;background:var(--line);display:inline-block;margin:0 6px"></span>
        <div class="viewbtn on" data-view="tree"><i class="fa-solid fa-diagram-project"></i> 계층</div>
        <div class="viewbtn" data-view="list"><i class="fa-solid fa-table-list"></i> 목록</div>
        <div class="viewbtn" data-view="net"><i class="fa-solid fa-share-nodes"></i> 네트워크</div>
      </div>

      <div class="visualization-area">
        <button class="btn fullscreen-btn" id="btnFull"><i class="fa-solid fa-expand"></i> 전체화면</button>

        <div class="stage" id="stage" tabindex="0" aria-label="시스템맵 캔버스">
          <!-- 밴드는 JS가 #bands에 동적 생성 -->
          <div id="bands"></div>
          <svg id="linksLayer"></svg>
          <div class="bottom-area" id="bottomArea">
            <span class="title">Version Info</span>
            <label class="switch">
              <input type="checkbox" id="verToggle"/>
              <span class="slider"></span>
            </label>
            <div class="ver-pills" id="verPills">
              <span class="ver-pill" data-ver="all">All</span>
              <span class="ver-pill" data-ver="v20">v2.0</span>
              <span class="ver-pill" data-ver="v15">v1.5</span>
              <span class="ver-pill" data-ver="v10">v1.0</span>
            </div>
          </div>
        </div>

        <div id="listView" style="display:none;margin-top:12px">
          <table class="table" id="table">
            <thead><tr><th>레벨</th><th>페이지</th><th>카테고리</th><th>상태</th><th>DS</th><th>담당</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="legend">
          <span><span class="dot" style="background:#1428a0;border-color:#0f1f73"></span>메인</span>
          <span><span class="dot" style="background:#f1f8ff;border-color:#7cc0ff"></span>카테고리</span>
          <span><span class="dot" style="background:#ffffff"></span>일반</span>
          <span><span class="dot" style="background:#e8fff7"></span>정상</span>
          <span><span class="dot" style="background:#fff7e8"></span>업데이트 필요</span>
          <span><span class="dot" style="background:#fff1f2"></span>확인 필요</span>
        </div>
      </div>

      <div class="footer">© 2025 Samsung.com System Map Demo • MX Focus • Front-only</div>
    </section>

    <!-- 더미 페이지 -->
    <section class="page" id="dashboard">
      <div class="header">
        <div>
          <div class="page-title">대시보드</div>
          <div class="page-subtitle">운영 현황 더미 데이터</div>
        </div>
      </div>
      <div class="visualization-area">
        <div class="kpi-grid" id="kpiGrid">
          <div class="kpi">
            <div class="kpi-label">총 페이지 수</div>
            <div class="kpi-value primary">1,248</div>
            <div class="kpi-sub">전주 대비 +2.3%</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">정상 적용률</div>
            <div class="kpi-value ok">92.4%</div>
            <div class="progress"><span style="width:92.4%"></span></div>
          </div>
          <div class="kpi">
            <div class="kpi-label">업데이트 필요</div>
            <div class="kpi-value warn">84</div>
            <div class="kpi-sub">전주 대비 -12</div>
          </div>
          <div class="kpi">
            <div class="kpi-label">이슈(확인 필요)</div>
            <div class="kpi-value err">9</div>
            <div class="kpi-sub">신규 3건</div>
          </div>
        </div>
        <div class="chart-grid">
          <div class="chart-card">
            <div class="chart-title">주간 트래픽(더미)</div>
            <svg class="spark" id="sparkTraffic" viewBox="0 0 200 60" preserveAspectRatio="none"></svg>
          </div>
          <div class="chart-card">
            <div class="chart-title">DS 버전 분포(더미)</div>
            <div class="bar-legend">
              <span class="dot" style="background:#1e3a8a;border-color:#1e3a8a"></span>v2.0
              <span class="dot" style="background:#b45309;border-color:#b45309"></span>v1.5
              <span class="dot" style="background:#991b1b;border-color:#991b1b"></span>v1.0
            </div>
            <div class="bars">
              <div class="bar-item"><span>v2.0</span><div class="bar-line"><i style="width:72%"></i><em>72%</em></div></div>
              <div class="bar-item"><span>v1.5</span><div class="bar-line"><i class="warn" style="width:18%"></i><em>18%</em></div></div>
              <div class="bar-item"><span>v1.0</span><div class="bar-line"><i class="err" style="width:10%"></i><em>10%</em></div></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="page" id="analytics"><div class="header"><div class="page-title">성능 분석(더미)</div></div><div class="visualization-area" style="height:360px;display:grid;place-items:center;color:#94a3b8">추가 예정</div></section>
    <section class="page" id="content"><div class="header"><div class="page-title">점검 항목(더미)</div></div><div class="visualization-area" style="height:360px;display:grid;place-items:center;color:#94a3b8">추가 예정</div></section>
  </main>
</div>

<!-- 상세 패널 -->
<aside class="detail-panel" id="detail">
  <div class="panel-h">
    <strong id="d-title">페이지 상세</strong>
    <div>
      <button class="btn" id="btnWire"><i class="fa-regular fa-window-maximize"></i> 와이어프레임</button>
      <button class="btn" id="btnClose"><i class="fa-solid fa-xmark"></i></button>
    </div>
  </div>
  <div class="grid">
    <div class="k">ID</div><div id="d-id">-</div>
    <div class="k">URL</div><div id="d-url">-</div>
    <div class="k">레벨</div><div id="d-level">-</div>
    <div class="k">카테고리</div><div id="d-cluster">-</div>
    <div class="k">상태</div><div id="d-status">-</div>
    <div class="k">DS</div><div id="d-ds">-</div>
    <div class="k">담당</div><div id="d-owner">-</div>
  </div>

  <div class="subttl">상하위 관계</div>
  <div class="badge-wrap" id="relNav"></div>

  <div class="subttl">컴포넌트(샘플)</div>
  <div class="badge-wrap" id="compBadges"></div>

  <div class="subttl">와이어프레임 썸네일</div>
  <div class="wf-thumb-wrap">
    <div class="wf-thumb" id="wfThumb"></div>
    <div class="wf-overlay" id="wfOverlay">
      <button class="btn-mini" onclick="triggerWfUpload(event)"><i class="fa-solid fa-upload"></i> 업로드</button>
      <button class="btn-mini" onclick="resetWfThumb(event)"><i class="fa-solid fa-rotate"></i> 초기화</button>
      <button class="btn-mini" onclick="downloadWfThumb(event)"><i class="fa-solid fa-download"></i> 저장</button>
    </div>
    <input type="file" id="wfInput" accept="image/*" style="display:none"/>
  </div>

  <div class="download-section">
    <div class="subttl">다운로드</div>
    <div class="download-buttons">
      <button class="download-btn xd" onclick="downloadFile('xd')">
        <i class="fa-solid fa-download"></i> XD
      </button>
      <button class="download-btn sketch" onclick="downloadFile('sketch')">
        <i class="fa-solid fa-download"></i> Sketch
      </button>
      <button class="download-btn zeplin" onclick="downloadFile('zeplin')">
        <i class="fa-solid fa-download"></i> Zeplin
      </button>
    </div>
  </div>
</aside>

<!-- 와이어프레임 모달 -->
<div class="modal" id="modal">
  <div class="wf">
    <div class="wf-h"><div><i class="fa-regular fa-window-maximize"></i> <span id="m-title">Wireframe</span></div>
      <button class="btn" id="m-close"><i class="fa-solid fa-xmark"></i></button></div>
    <div class="wf-body" id="m-body"></div>
  </div>
</div>

<script>
/* ---------- 배치 상수 (PDF 간격 반영) ---------- */
const bandH = 150;          // 레벨 기본 높이
const leftBase = 140;       // 좌측 여백
const colW = 260;           // 열 폭(조금 넓힘)
const gapX = 40;            // 열 간격
const gapY = 22;            // 행 간격

/* ---------- 데이터: PDF 구조 반영 ---------- */
/* L0: Home, PFS, Shop, My Page, Accessories
   L1: Smartphones, Tablets, Book&Laptops, Watches, Buds, Galaxy Accessories, Sub Menu
   L2: 각 허브 하위(All/S/Z/A/Compare/Acc...), Sub Menu 항목
   L3: PD 레벨(Flagship/Featured/Standard)
   L4: Buying/Cart */
const nodesMX = [
  // L0
  {id:'home', title:'Home', level:0, col:0, row:0, type:'main', status:'ok', ds:'v2.0', cluster:'global'},
  {id:'pfs',  title:'PFS',  level:0, col:1, row:0, type:'page', status:'ok', ds:'v2.0', cluster:'global', parent:'home'},
  {id:'shop', title:'Shop', level:0, col:2, row:0, type:'page', status:'ok', ds:'v2.0', cluster:'global', parent:'home'},
  {id:'mypage', title:'My Page', level:0, col:3, row:0, type:'page', status:'ok', ds:'v2.0', cluster:'global', parent:'home'},
  {id:'top-acc', title:'Accessories (Top)', level:0, col:4, row:0, type:'page', status:'ok', ds:'v2.0', cluster:'global', parent:'home'},

  // L1 허브
  {id:'smartphones', title:'Smartphones', level:1, col:1, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'smartphones', parent:'home'},
  {id:'tablets',     title:'Tablets',     level:1, col:3, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'tablets', parent:'home'},
  {id:'book',        title:'Book & Laptops', level:1, col:5, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'book', parent:'home'},
  {id:'watch',       title:'Watches',     level:1, col:7, row:0, type:'category', status:'warn', ds:'v1.5', cluster:'watch', parent:'home'},
  {id:'buds',        title:'Buds',        level:1, col:9, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'buds', parent:'home'},
  {id:'acc',         title:'Galaxy Accessories', level:1, col:11, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'acc', parent:'home'},
  {id:'submenu',     title:'Sub Menu',    level:1, col:13, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'sub', parent:'home'},

  // L2 스마트폰
  {id:'sp-all',  title:'All',       level:2,col:1,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-s',    title:'Galaxy S',  level:2,col:2,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-z',    title:'Galaxy Z',  level:2,col:3,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-a',    title:'Galaxy A',  level:2,col:4,row:0,parent:'smartphones',cluster:'smartphones',status:'warn',ds:'v1.0'},
  {id:'sp-comp', title:'Compare',   level:2,col:5,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'sp-acc',  title:'Accessories',level:2,col:6,row:0,parent:'smartphones',cluster:'smartphones',status:'ok',ds:'v2.0'},

  // L2 태블릿
  {id:'tb-all', title:'All',       level:2,col:3,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'tb-s',   title:'Tab S',     level:2,col:4,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'tb-a',   title:'Tab A',     level:2,col:5,row:1,parent:'tablets',cluster:'tablets',status:'warn',ds:'v1.5'},
  {id:'tb-comp',title:'Compare',   level:2,col:6,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'tb-acc', title:'Accessories',level:2,col:7,row:1,parent:'tablets',cluster:'tablets',status:'ok',ds:'v2.0'},

  // L2 워치
  {id:'wt-all',    title:'All',          level:2,col:7,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-ultra',  title:'Watch Ultra',  level:2,col:8,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-watch',  title:'Watch',        level:2,col:9,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-classic',title:'Watch Classic',level:2,col:10,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-comp',   title:'Compare',      level:2,col:11,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'wt-acc',    title:'Accessories',  level:2,col:12,row:0,parent:'watch',cluster:'watch',status:'ok',ds:'v2.0'},

  // L2 버즈
  {id:'bd-all',  title:'All',     level:2,col:9,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-pro',  title:'Buds3 Pro',level:2,col:10,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-3',    title:'Buds3',   level:2,col:11,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-fe',   title:'Buds FE', level:2,col:12,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'bd-comp', title:'Compare', level:2,col:13,row:1,parent:'buds',cluster:'buds',status:'ok',ds:'v2.0'},

  // L2 북/랩탑
  {id:'bk-all',  title:'All',        level:2,col:5,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-book', title:'Book',       level:2,col:6,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-360',  title:'Book 360',   level:2,col:7,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-chr',  title:'Chromebook', level:2,col:8,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-gpc',  title:'Copilot+PC', level:2,col:9,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},
  {id:'bk-comp', title:'Compare',    level:2,col:10,row:0,parent:'book',cluster:'book',status:'ok',ds:'v2.0'},

  // L2 서브메뉴 묶음
  {id:'sm-discover', title:'Discover Mobile', level:2, col:13, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-galaxyai', title:'Galaxy AI',       level:2, col:14, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-oneui',    title:'One UI',          level:2, col:15, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-health',   title:'Samsung Health',  level:2, col:16, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-care',     title:'Samsung Care+',   level:2, col:17, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-why',      title:'Why Galaxy',      level:2, col:18, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-switch',   title:'Switch to Galaxy',level:2, col:19, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},
  {id:'sm-trade',    title:'Mobile Trade-in', level:2, col:20, row:0, parent:'submenu', cluster:'sub', status:'ok', ds:'v2.0'},

  // L3 PD 레벨 (주요만)
  {id:'pd-s-flag', title:'Flagship PD (S)',   level:3,col:2,row:0,parent:'sp-s',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'pd-z-feat', title:'Featured PD (Z)',   level:3,col:3,row:0,parent:'sp-z',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'pd-a-std',  title:'Standard PD (A)',   level:3,col:4,row:0,parent:'sp-a',cluster:'smartphones',status:'warn',ds:'v1.0'},
  {id:'pd-tab-flag',title:'Flagship PD (Tab S)',level:3,col:4,row:1,parent:'tb-s',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'pd-watch-feat',title:'Featured PD (Watch)',level:3,col:8,row:0,parent:'wt-ultra',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'pd-buds-std', title:'Standard PD (Buds)',  level:3,col:11,row:1,parent:'bd-3',cluster:'buds',status:'ok',ds:'v2.0'},
  {id:'pd-book-feat',title:'Featured PD (Book)',  level:3,col:6,row:0,parent:'bk-book',cluster:'book',status:'ok',ds:'v2.0'},

  // L4 Buying/Cart
  {id:'buy-flag-s',  title:'Flagship Buying PD (S)', level:4,col:2,row:0,parent:'pd-s-flag',cluster:'smartphones',status:'ok',ds:'v2.0'},
  {id:'buy-simple-a',title:'Simple Buying PD (A)',   level:4,col:4,row:0,parent:'pd-a-std',cluster:'smartphones',status:'warn',ds:'v1.0'},
  {id:'buy-tab',     title:'Buying PD (Tab)',        level:4,col:4,row:1,parent:'pd-tab-flag',cluster:'tablets',status:'ok',ds:'v2.0'},
  {id:'buy-watch',   title:'Simple PD (Watch)',      level:4,col:8,row:0,parent:'pd-watch-feat',cluster:'watch',status:'ok',ds:'v2.0'},
  {id:'cart',        title:'Cart page',              level:4,col:6,row:2,parent:'buy-flag-s',cluster:'global',status:'ok',ds:'v2.0'},
];

// 현재 표시 데이터 세트 (기본: MX)
let nodes = [...nodesMX];

/* ---------- 엘리먼트 ---------- */
const stage = document.getElementById('stage');
const bands = document.getElementById('bands');
const linksLayer = document.getElementById('linksLayer');
const listTbody = document.querySelector('#table tbody');
const btnFull = document.getElementById('btnFull');
const detail = document.getElementById('detail');
const originalDetailParent = detail.parentElement;
const bottomArea = document.getElementById('bottomArea');
const originalBottomAreaParent = bottomArea.parentElement;

/* 좌표 계산: 레벨/순서 기반 자동 배치 */
function xy(n){
  const levelIndex = n.level || 0;
  // 같은 레벨 내 순서를 col 값/없으면 id 정렬로 결정
  const inLevel = nodes.filter(x=>x.level===levelIndex);
  inLevel.sort((a,b)=>{
    const ac = (typeof a.col==='number')?a.col: Number.MAX_SAFE_INTEGER;
    const bc = (typeof b.col==='number')?b.col: Number.MAX_SAFE_INTEGER;
    if(ac!==bc) return ac-bc;
    return String(a.id).localeCompare(String(b.id));
  });
  const indexInLevel = inLevel.findIndex(x=>x.id===n.id);
  return {
    x: leftBase + indexInLevel*(colW + gapX),
    y: 20 + levelIndex*bandH
  };
}

/* 밴드 동적 생성/업데이트(노드 실제 위치에 맞춰 높이 자동 조절) */
function updateBands(){
  bands.innerHTML = '';
  const levels = [0,1,2,3,4];
  // 밴드 간 공백이 생기지 않도록 이전 밴드의 끝지점을 이어붙이는 방식으로 배치
  let runningTop = 0;
  levels.forEach(lv=>{
    const els = [...stage.querySelectorAll(`.node[data-level="${lv}"]`)]
                  .filter(e=>e.style.display!=='none');
    if(!els.length) return;
    const tops = els.map(e=>e.offsetTop);
    const bottoms = els.map(e=>e.offsetTop + e.offsetHeight);
    const minTop = Math.min(...tops);
    const maxBottom = Math.max(...bottoms);

    const bandTop = runningTop; // 바로 이전 밴드의 하단부터 시작하여 공백 제거
    const bandHeightPx = Math.max(maxBottom - bandTop + 20, 0); // 노드 하단과 밴드 하단 간격 20px 추가

    const band = document.createElement('div');
    band.className = 'level-band';
    band.style.left = '0px';
    band.style.width = '100%';
    band.style.top = bandTop+'px';
    // height를 %로 설정하기 위해 전체 높이 대비 비율 계산
    const totalH = parseFloat(getComputedStyle(stage).getPropertyValue('--inner-h')) || (stage.scrollHeight || (stage.clientHeight));
    const bandHeightPercent = totalH ? (bandHeightPx / totalH) * 100 : 0;
    band.style.height = bandHeightPercent + '%';
    const label = document.createElement('span');
    label.className = 'level-label';
    label.textContent = `L${lv} · ${['Home/Global','카테고리 허브','제품군/세부','PD 상위','Buying/Cart'][lv]||''}`;
    band.appendChild(label);
    bands.appendChild(band);

    runningTop = bandTop + bandHeightPx;
  });
}

/* 렌더 */
function paint(){
  // 초기화
  stage.querySelectorAll('.node').forEach(e=>e.remove());
  linksLayer.innerHTML='';

  // 노드 생성 (카테고리/ID 정렬)
  const clusterOrder = ['smartphones','tablets','book','watch','buds','acc','sub','global'];
  const ordered = [...nodes].sort((a,b)=>{
    if(a.level!==b.level) return a.level-b.level;
    const ai = clusterOrder.indexOf(a.cluster);
    const bi = clusterOrder.indexOf(b.cluster);
    if(ai!==bi) return ai-bi;
    return String(a.id).localeCompare(String(b.id));
  });
  ordered.forEach(n=>{
    const pos = xy(n);
    const el = document.createElement('div');
    el.className = 'node' + (n.type==='category'?' category':'') + (n.type==='main'?' main':'');
    el.style.left = pos.x+'px'; el.style.top = pos.y+'px';
    el.dataset.id=n.id; el.dataset.level=n.level; el.dataset.cluster=n.cluster; el.title=n.title;
    const icon = (n.type==='main')?'<i class="fa-solid fa-house"></i>':(n.type==='category')?'<i class="fa-solid fa-layer-group"></i>':'<i class="fa-regular fa-file"></i>';
    el.innerHTML = `
      ${n.type!=='main' ? `<span class="tn"><span class="bar b1"></span><span class="bar b2"></span><span class="kv"></span></span>` : ''}
      <div>
        <div class="title">${icon} ${n.title}</div>
        <div class="badges">
          <span class="b ${n.ds?.startsWith('v2')?'v2':''}">${n.ds||'v—'}</span>
          <span class="b ${n.status==='ok'?'ok':n.status==='warn'?'warn':'err'}">${n.status==='ok'?'정상':n.status==='warn'?'업데이트':'확인'}</span>
        </div>
      </div>`;
    el.addEventListener('click',()=>openDetail(n));
    el.addEventListener('dblclick',()=>openWire(n));
    stage.appendChild(el);
  });

  // 같은 레벨 내 간단 겹침 해소
  const MAX_ITERS = 30;
  for(let t=0;t<MAX_ITERS;t++){
    let moved=false;
    const cards=[...stage.querySelectorAll('.node')];
    for(let i=0;i<cards.length;i++){
      for(let j=i+1;j<cards.length;j++){
        const a=cards[i], b=cards[j];
        if(a.dataset.level!==b.dataset.level) continue;
        const ra=a.getBoundingClientRect(), rb=b.getBoundingClientRect(), rs=stage.getBoundingClientRect();
        const A={x1:ra.left-rs.left, y1:ra.top-rs.top, x2:ra.right-rs.left, y2:ra.bottom-rs.top};
        const B={x1:rb.left-rs.left, y1:rb.top-rs.top, x2:rb.right-rs.left, y2:rb.bottom-rs.top};
        const overlap = !(A.x2+10 < B.x1 || B.x2+10 < A.x1 || A.y2+10 < B.y1 || B.y2+10 < A.y1);
        if(overlap){
          const shift = 24;
          (parseFloat(a.style.left) <= parseFloat(b.style.left))
            ? b.style.top = (parseFloat(b.style.top)+shift)+'px'
            : a.style.top = (parseFloat(a.style.top)+shift)+'px';
          moved=true;
        }
      }
    }
    if(!moved) break;
  }

  // 내부 영역 크기 계산 및 레이어 확장
  const bottoms = [...stage.querySelectorAll('.node')].map(n=>n.offsetTop + n.offsetHeight);
  const rights = [...stage.querySelectorAll('.node')].map(n=>n.offsetLeft + n.offsetWidth);
  const maxBottom = Math.max(...bottoms, 760);
  const maxRight = Math.max(...rights, stage.clientWidth);
  const innerH = maxBottom + 260;
  const innerW = maxRight + 100;
  // 스크롤 영역 변수 및 레이어 크기 반영
  stage.style.setProperty('--inner-h', innerH+'px');
  linksLayer.setAttribute('height', innerH);
  linksLayer.setAttribute('width', innerW);
  linksLayer.style.height = innerH+'px';
  linksLayer.style.width = innerW+'px';
  bands.style.height = innerH+'px';
  bands.style.width = innerW+'px';

  // 커넥터 (직각 경로)
  nodes.filter(n=>n.parent).forEach(n=>{
    const c = stage.querySelector(`.node[data-id="${n.id}"]`).getBoundingClientRect();
    const p = stage.querySelector(`.node[data-id="${n.parent}"]`).getBoundingClientRect();
    const s = stage.getBoundingClientRect();
    const x1 = p.left - s.left + (p.width/2), y1 = p.top - s.top + p.height;
    const x2 = c.left - s.left + (c.width/2), y2 = c.top - s.top;
    // 세그먼트: 아래로 수직 → 수평으로 자식 x까지
    // 꺾이는 y지점은 부모와 자식의 중간 지점으로 설정해 시각적 간섭 최소화
    const midY = (y1 + y2) / 2;
    const d = `M ${x1} ${y1} V ${midY} H ${x2} V ${y2}`;
    linksLayer.insertAdjacentHTML('beforeend', `<path d="${d}" fill="none" stroke="#cfd8e3" stroke-width="2"/>`);
  });

  // 내부 높이 확보 (변수 유지)
  stage.style.setProperty('--inner-h', innerH+'px');

  // 밴드 업데이트
  updateBands();

  // 목록 뷰 데이터
  if(listTbody){
    listTbody.innerHTML = nodes.map(n=>`
      <tr>
        <td>L${n.level}</td><td>${n.title}</td><td>${n.cluster}</td>
        <td>${n.status==='ok'?'<span class="b ok">정상</span>':n.status==='warn'?'<span class="b warn">업데이트</span>':'<span class="b err">확인</span>'}</td>
        <td><span class="b ${n.ds?.startsWith('v2')?'v2':''}">${n.ds||''}</span></td>
        <td>A/B/C 에이전시</td>
      </tr>`).join('');
  }
}
paint();

/* ---------- 검색/필터/뷰 ---------- */
function applyFilters(){
  stage.querySelectorAll('.node').forEach(n=>{
    const cluster = n.dataset.cluster;
    const level = n.dataset.level;
    const clusterOk = activeClusters.has('all') || activeClusters.has(cluster);
    const levelOk = activeLevels.has('all') || activeLevels.has(level);
    n.style.display = (clusterOk && levelOk)? 'grid':'none';
  });
  linksLayer.innerHTML='';
  updateBands();
}
document.querySelectorAll('.nav-item').forEach(i=>{
  i.addEventListener('click',()=>{
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active')); i.classList.add('active');
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(i.dataset.page).classList.add('active');
    // 대시보드 진입 시 차트 렌더
    if(i.dataset.page==='dashboard'){ renderDashboard(); }
  });
});
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input',()=>{
  const q = searchInput.value.trim().toLowerCase();
  stage.querySelectorAll('.node').forEach(n=>{
    const match = n.textContent.toLowerCase().includes(q);
    n.style.opacity = q? (match? '1': '.22') : '1';
    n.style.outline = match? '2px solid var(--accent)' : 'none';
  });
});
// 레벨 다중 선택 필터
const levelPills = document.querySelectorAll('.pill[data-level]');
let activeLevels = new Set(['all']);
levelPills.forEach(p=>{
  p.addEventListener('click',()=>{
    const lv = p.dataset.level;
    if(lv==='all'){
      activeLevels = new Set(['all']);
      levelPills.forEach(x=>x.classList.remove('multi','on'));
      p.classList.add('on');
    }else{
      if(activeLevels.has('all')){ activeLevels.delete('all'); document.querySelector('.pill[data-level="all"]').classList.remove('on'); }
      if(activeLevels.has(lv)){ activeLevels.delete(lv); p.classList.remove('multi'); }
      else{ activeLevels.add(lv); p.classList.add('multi'); }
      if(activeLevels.size===0){ activeLevels.add('all'); document.querySelector('.pill[data-level="all"]').classList.add('on'); }
    }
    applyFilters();
  });
});
// 카테고리 다중 선택 필터
const clusterPills = document.querySelectorAll('.pill[data-cluster]');
let activeClusters = new Set(['all']);
clusterPills.forEach(p=>{
  p.addEventListener('click',()=>{
    const c = p.dataset.cluster;
    if(c==='all'){
      activeClusters = new Set(['all']);
      clusterPills.forEach(x=>x.classList.remove('multi','on'));
      p.classList.add('on');
    }else{
      if(activeClusters.has('all')){ activeClusters.delete('all'); document.querySelector('.pill[data-cluster="all"]').classList.remove('on'); }
      if(activeClusters.has(c)){
        activeClusters.delete(c); p.classList.remove('multi');
      }else{
        activeClusters.add(c); p.classList.add('multi');
      }
      if(activeClusters.size===0){ activeClusters.add('all'); document.querySelector('.pill[data-cluster="all"]').classList.add('on'); }
    }
    // 필터 적용
    applyFilters();
  });
});
const listView = document.getElementById('listView');
document.querySelectorAll('.viewbtn').forEach(v=>{
  v.addEventListener('click',()=>{
    document.querySelectorAll('.viewbtn').forEach(x=>x.classList.remove('on')); v.classList.add('on');
    const mode = v.dataset.view;
    if(mode==='tree'){ stage.style.display='block'; listView.style.display='none'; paint(); }
    if(mode==='list'){ stage.style.display='none'; listView.style.display='block'; }
    if(mode==='net'){ stage.style.display='block'; listView.style.display='none'; alert('네트워크 뷰는 시각적 더미입니다.'); paint(); }
  });
});
document.getElementById('btnExport').addEventListener('click',()=>{
  const payload = {exportedAt:new Date().toISOString(), nodes};
  const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='mx-system-map-demo.json'; a.click();
  URL.revokeObjectURL(a.href);
});
document.getElementById('btnReload').addEventListener('click',()=>location.reload());

/* ---------- 대시보드(더미) 렌더 ---------- */
function renderDashboard(){
  const svg = document.getElementById('sparkTraffic');
  if(!svg) return;
  const w = 200, h = 60, pad = 4;
  svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
  // 더미 데이터: 주간 트래픽
  const points = [24,30,28,35,40,38,44,50,48,55,58,62];
  const maxV = Math.max(...points), minV = Math.min(...points);
  const norm = v => h - pad - ((v - minV) / (maxV - minV)) * (h - pad*2);
  const step = (w - pad*2) / (points.length - 1);
  const d = points.map((v,idx)=>`${pad+idx*step},${norm(v)}`).join(' ');
  svg.innerHTML = `
    <polyline points="${d}" fill="none" stroke="var(--primary)" stroke-width="2"/>
    <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.25"/>
      <stop offset="100%" stop-color="#3b82f6" stop-opacity="0"/>
    </linearGradient>
    <polygon points="${pad},${h-pad} ${d} ${w-pad},${h-pad}" fill="url(#g1)"/>
  `;
}

/* ---------- 상세 패널(배지/와이어프레임) ---------- */
const compsByCluster = {
  smartphones:['C004 Category HScroll','FT02 Feature Grid','PD01 Product Cards','BN01 Key Visual'],
  tablets:['C004 Category HScroll','FT02 Feature Grid','PD03 Spec Table','BN01 Key Visual'],
  watch:['C007 Filter Chips','PD01 Product Cards','FT05 Comparison','BN02 KV Carousel'],
  buds:['PD01 Product Cards','FT03 Benefit Icons','C010 Reviews'],
  book:['FT02 Feature Grid','PD01 Product Cards','C012 Tech Specs'],
  acc:['ACC01 Accessory Grid','ACC02 Compatibility'],
  sub:['LP01 Hero','LP02 Icon Grid'],
  global:['GN01 GNB','FT01 Hero','C013 Footer']
};
function renderWfThumb(cluster='smartphones'){
  const wrap = document.getElementById('wfThumb');
  // 로컬 스토리지에 저장된 사용자 이미지 우선 적용
  const saved = localStorage.getItem('wfThumbImage');
  if(saved){
    wrap.innerHTML = `<img src="${saved}" alt="uploaded"/>`;
    return;
  }
  wrap.innerHTML = `
    <div class="wf-h1"></div>
    <div class="wf-h2"></div>
    <div class="wf-hero"></div>
    <div class="wf-grid">
      <div class="card"><div class="img"></div><div class="bar s"></div><div class="bar xs"></div></div>
      <div class="card"><div class="img"></div><div class="bar s"></div><div class="bar xs"></div></div>
      <div class="card"><div class="img"></div><div class="bar s"></div><div class="bar xs"></div></div>
    </div>`;
}
function openDetail(n){
  document.getElementById('d-title').textContent = n.title;
  document.getElementById('d-id').textContent = n.id;
  document.getElementById('d-url').innerHTML = `<a href="#" onclick="return false;">https://www.samsung.com/kr/mx/${n.id}</a>`;
  document.getElementById('d-level').textContent = 'L'+n.level;
  document.getElementById('d-cluster').textContent = n.cluster;
  document.getElementById('d-ds').innerHTML = `<span class="status-badge ${n.ds?.startsWith('v2')?'sb-ok':'sb-warn'}">${n.ds}</span>`;
  const st = n.status==='ok'?'sb-ok':n.status==='warn'?'sb-warn':'sb-err';
  document.getElementById('d-status').innerHTML = `<span class="status-badge ${st}">${n.status==='ok'?'정상':n.status==='warn'?'업데이트 필요':'관리자 확인'}</span>`;
  document.getElementById('d-owner').textContent = 'MX 사업부 · A/B/C 에이전시';
  // 컴포넌트 배지
  const bag = document.getElementById('compBadges');
  bag.innerHTML = (compsByCluster[n.cluster]||compsByCluster.global).map(t=>`<span class="chip">${t}</span>`).join('');
  // 상하위 관계
  const rel = document.getElementById('relNav');
  const parent = nodes.find(x=>x.id===n.parent);
  const children = nodes.filter(x=>x.parent===n.id);
  rel.innerHTML = `
    ${parent?`<a class="chip" href="#" data-go="${parent.id}">▲ ${parent.title}</a>`:''}
    ${children.map(c=>`<a class=\"chip\" href=\"#\" data-go=\"${c.id}\">▼ ${c.title}</a>`).join(' ')}
  `;
  rel.querySelectorAll('a[data-go]').forEach(a=>{
    a.addEventListener('click',(e)=>{
      e.preventDefault();
      const id = a.getAttribute('data-go');
      const target = nodes.find(x=>x.id===id);
      if(target){ openDetail(target); }
    });
  });
  // 와이어프레임 썸네일
  renderWfThumb(n.cluster);
  detail.classList.add('open');
}
document.getElementById('btnClose').addEventListener('click',()=>detail.classList.remove('open'));

// wf-thumb 이미지 업로드/초기화/저장
function triggerWfUpload(ev){
  if(ev) ev.stopPropagation();
  const inp = document.getElementById('wfInput');
  inp.value = '';
  inp.click();
}
document.addEventListener('change',(e)=>{
  if(e.target && e.target.id==='wfInput' && e.target.files && e.target.files[0]){
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = ()=>{
      const wrap = document.getElementById('wfThumb');
      const dataUrl = reader.result;
      wrap.innerHTML = `<img src="${dataUrl}" alt="uploaded"/>`;
      try{ localStorage.setItem('wfThumbImage', dataUrl); }catch(err){ console.warn('이미지 저장 실패', err); }
    };
    reader.readAsDataURL(file);
  }
});
// Version Info 토글 → visualization-area 다크 테마 전환
const verToggle = document.getElementById('verToggle');
const vizArea = document.querySelector('.visualization-area');
if(verToggle){
  verToggle.addEventListener('change',()=>{
    const pills = document.getElementById('verPills');
    if(verToggle.checked){ vizArea.classList.add('dark'); applyDsTheming(); pills.classList.remove('disabled'); }
    else{ vizArea.classList.remove('dark'); clearDsTheming(); pills.classList.add('disabled'); }
  });
  // 초기 상태: off → 비활성화
  document.getElementById('verPills').classList.add('disabled');
}

// DS 기반 노드 배경색 적용/해제 (다크 테마 전용)
function applyDsTheming(){
  if(!document.querySelector('.visualization-area').classList.contains('dark')) return;
  stage.querySelectorAll('.node').forEach(el=>{
    const id = el.dataset.id;
    const node = nodes.find(n=>n.id===id);
    const ds = node?.ds || '';
    let bg = '#0f1a36';
    if(/^v2/i.test(ds)) bg = '#0a1f3f';     // v2.x: 더 파란 톤
    else if(/^v1/i.test(ds)) bg = '#2a1a0f'; // v1.x: 브라운 톤
    el.style.backgroundColor = bg;
  });
}
function clearDsTheming(){
  stage.querySelectorAll('.node').forEach(el=>{ el.style.backgroundColor=''; });
}

// Version 필터/정렬
const verPills = document.getElementById('verPills');
if(verPills){
  verPills.addEventListener('click',(e)=>{
    const target = e.target.closest('.ver-pill');
    if(!target) return;
    verPills.querySelectorAll('.ver-pill').forEach(p=>p.classList.remove('on'));
    target.classList.add('on');
    const key = target.dataset.ver;
    if(key==='all'){
      // 전체 초기화: 현재의 레벨/카테고리 필터만 반영하여 표시 상태 재계산
      applyFilters();
      applyDsTheming();
      return;
    }
    // 필터: 표시 조건
    stage.querySelectorAll('.node').forEach(el=>{
      const node = nodes.find(n=>n.id===el.dataset.id);
      const ds = node?.ds || '';
      let ok = true;
      if(key==='v20') ok = /^v2\.0$/i.test(ds);
      else if(key==='v15') ok = /^v1\.5$/i.test(ds);
      else if(key==='v10') ok = /^v1\.0$/i.test(ds);
      // 기존 레벨/클러스터 필터와 함께 동작하도록 display를 조합
      if(ok){
        // 유지: 다른 필터가 숨겼다면 건드리지 않음
        if(el.style.display==='none') return;
        el.style.display = 'grid';
      }else{
        el.style.display = 'none';
      }
    });
    linksLayer.innerHTML='';
    updateBands();
    applyDsTheming();
  });
}

// 사업부 선택 → 데이터세트 전환 (MX: 실제 데이터, 그 외: 더미 데이터)
const bizSelect = document.getElementById('bizSelect');
if(bizSelect){
  bizSelect.addEventListener('change',()=>{
    const v = bizSelect.value;
    if(v==='' || v==='mx'){
      nodes = [...nodesMX];
    }else{
      // 간단 더미: 상위 1개 + 카테고리 3개 + 하위 6개 정도
      const baseId = v.toUpperCase();
      nodes = [
        {id:`${v}-home`, title:`${baseId} Home`, level:0, col:0, row:0, type:'main', status:'ok', ds:'v2.0', cluster:'global'},
        {id:`${v}-hub-1`, title:`${baseId} Hub A`, level:1, col:1, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'smartphones', parent:`${v}-home`},
        {id:`${v}-hub-2`, title:`${baseId} Hub B`, level:1, col:3, row:0, type:'category', status:'warn', ds:'v1.5', cluster:'tablets', parent:`${v}-home`},
        {id:`${v}-hub-3`, title:`${baseId} Hub C`, level:1, col:5, row:0, type:'category', status:'ok', ds:'v2.0', cluster:'book', parent:`${v}-home`},
        {id:`${v}-p1`, title:'Page 1', level:2, col:1, row:0, parent:`${v}-hub-1`, cluster:'smartphones', status:'ok', ds:'v2.0'},
        {id:`${v}-p2`, title:'Page 2', level:2, col:2, row:0, parent:`${v}-hub-1`, cluster:'smartphones', status:'warn', ds:'v1.0'},
        {id:`${v}-p3`, title:'Page 3', level:2, col:3, row:0, parent:`${v}-hub-2`, cluster:'tablets', status:'ok', ds:'v2.0'},
        {id:`${v}-p4`, title:'Page 4', level:2, col:4, row:0, parent:`${v}-hub-2`, cluster:'tablets', status:'ok', ds:'v2.0'},
        {id:`${v}-p5`, title:'Page 5', level:2, col:5, row:0, parent:`${v}-hub-3`, cluster:'book', status:'ok', ds:'v2.0'},
        {id:`${v}-p6`, title:'Page 6', level:2, col:6, row:0, parent:`${v}-hub-3`, cluster:'book', status:'warn', ds:'v1.5'},
      ];
    }
    // 재페인트 및 필터/커넥터 갱신
    paint();
    applyFilters();
    applyDsTheming();
  });
}
function resetWfThumb(ev){
  if(ev) ev.stopPropagation();
  localStorage.removeItem('wfThumbImage');
  renderWfThumb();
}
function downloadWfThumb(ev){
  if(ev) ev.stopPropagation();
  const saved = localStorage.getItem('wfThumbImage');
  if(!saved){ alert('저장된 이미지가 없습니다. 먼저 업로드하세요.'); return; }
  const a = document.createElement('a');
  a.href = saved;
  a.download = 'wf-thumb.png';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

/* ---------- 와이어프레임 모달 ---------- */
const modal = document.getElementById('modal'), mBody=document.getElementById('m-body'), mTitle=document.getElementById('m-title');
document.getElementById('m-close').addEventListener('click',()=>modal.classList.remove('show'));
document.getElementById('btnWire').addEventListener('click',()=>modal.classList.add('show'));
function openWire(n){
  mTitle.textContent = `${n.title} · Wireframe`;
  mBody.innerHTML = `
    <div class="wf-skel">
      <div class="skel-bar" style="width:40%"></div>
      <div class="skel-bar" style="width:65%"></div>
      <div class="skel-img"></div>
      <div class="skel-grid">
        <div class="wf-skel"><div class="skel-img" style="height:90px"></div><div class="skel-bar" style="width:70%"></div><div class="skel-bar" style="width:50%"></div></div>
        <div class="wf-skel"><div class="skel-img" style="height:90px"></div><div class="skel-bar" style="width:70%"></div><div class="skel-bar" style="width:50%"></div></div>
        <div class="wf-skel"><div class="skel-img" style="height:90px"></div><div class="skel-bar" style="width:70%"></div><div class="skel-bar" style="width:50%"></div></div>
      </div>
      <div class="skel-bar" style="width:92%"></div>
      <div class="skel-bar" style="width:84%"></div>
      <div class="skel-bar" style="width:76%"></div>
    </div>`;
  modal.classList.add('show');
}

/* ---------- 전체화면(사이드바 보이게) ---------- */
btnFull.addEventListener('click', async ()=>{
  if(!document.fullscreenElement){
    await stage.requestFullscreen();
    // 상세 패널을 stage 내부로 옮김 (fullscreen에서도 보이도록)
    if(detail.parentElement!==stage){ stage.appendChild(detail); detail.classList.add('fs'); }
    // bottom-area도 stage 내부로 이동하여 하단 고정
    if(bottomArea.parentElement!==stage){ stage.appendChild(bottomArea); }
    btnFull.innerHTML = '<i class="fa-solid fa-compress"></i> 전체화면 종료';
  }else{
    await document.exitFullscreen();
    // 상세 패널 원위치 복귀
    if(detail.parentElement===stage){ originalDetailParent.appendChild(detail); detail.classList.remove('fs'); }
    // bottom-area 원위치 복귀
    if(bottomArea.parentElement===stage){ originalBottomAreaParent.appendChild(bottomArea); }
    btnFull.innerHTML = '<i class="fa-solid fa-expand"></i> 전체화면';
  }
});
document.addEventListener('fullscreenchange',()=>{
  if(document.fullscreenElement===stage){
    if(detail.parentElement!==stage){ stage.appendChild(detail); detail.classList.add('fs'); }
    if(bottomArea.parentElement!==stage){ stage.appendChild(bottomArea); }
    // 전체화면에서는 viewport 하단에 고정
    bottomArea.classList.add('fixed-bottom');
    // 상단바 표시
    let topbar = document.getElementById('fsTopbar');
    if(!topbar){
      topbar = document.createElement('div');
      topbar.id = 'fsTopbar';
      topbar.className = 'fs-topbar';
      topbar.textContent = 'S.COM - Sitemap';
      document.body.appendChild(topbar);
    }
    topbar.style.display = 'flex';
  }else{
    if(detail.parentElement===stage){ originalDetailParent.appendChild(detail); detail.classList.remove('fs'); }
    if(bottomArea.parentElement===stage){ originalBottomAreaParent.appendChild(bottomArea); }
    bottomArea.classList.remove('fixed-bottom');
    const topbar = document.getElementById('fsTopbar');
    if(topbar){ topbar.style.display = 'none'; }
    btnFull.innerHTML = '<i class="fa-solid fa-expand"></i> 전체화면';
  }
});

/* ---------- 다운로드 기능 ---------- */
function downloadFile(type) {
  const currentTitle = document.getElementById('d-title').textContent;
  const fileName = `${currentTitle}_${type.toUpperCase()}.${type === 'xd' ? 'xd' : type === 'sketch' ? 'sketch' : 'zeplin'}`;
  
  // 더미 파일 내용 생성
  let content = '';
  let mimeType = '';
  
  switch(type) {
    case 'xd':
      content = `Adobe XD 파일 - ${currentTitle}\n\n이 파일은 ${currentTitle} 페이지의 와이어프레임을 포함합니다.\n\n생성일: ${new Date().toLocaleDateString('ko-KR')}\n버전: 1.0`;
      mimeType = 'application/octet-stream';
      break;
    case 'sketch':
      content = `Sketch 파일 - ${currentTitle}\n\n이 파일은 ${currentTitle} 페이지의 디자인을 포함합니다.\n\n생성일: ${new Date().toLocaleDateString('ko-KR')}\n버전: 1.0`;
      mimeType = 'application/octet-stream';
      break;
    case 'zeplin':
      content = `Zeplin 파일 - ${currentTitle}\n\n이 파일은 ${currentTitle} 페이지의 스펙을 포함합니다.\n\n생성일: ${new Date().toLocaleDateString('ko-KR')}\n버전: 1.0`;
      mimeType = 'application/octet-stream';
      break;
  }
  
  // 파일 다운로드
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = fileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  // 다운로드 완료 알림
  const btn = event.target.closest('.download-btn');
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="fa-solid fa-check"></i> 완료';
  btn.style.background = '#e8fff7';
  btn.style.color = '#047857';
  btn.style.borderColor = '#bbf7d0';
  
  setTimeout(() => {
    btn.innerHTML = originalText;
    btn.style.background = '';
    btn.style.color = '';
    btn.style.borderColor = '';
  }, 2000);
}

/* ---------- 접근성 ---------- */
document.addEventListener('keydown',(e)=>{
  if(e.key==='Escape'){ detail.classList.remove('open'); modal.classList.remove('show'); }
  if((e.key==='f' || e.key==='F') && document.activeElement.closest('#stage')) btnFull.click();
});
</script>
</body>
</html>
